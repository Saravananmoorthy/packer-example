box: debian
build:
  steps:
    - install-packages:
        packages: wget unzip
    - script:
        name: install packer
        code: |
          wget https://d29vzk4ow07wi7.cloudfront.net/89b4f076aa6fc5f37cbe56ba03d93c94d61f16cc?response-content-disposition=attachment%3Bfilename%3D%22packer_0.8.5_linux_amd64.zip%22&Policy=eyJTdGF0ZW1lbnQiOiBbeyJSZXNvdXJjZSI6Imh0dHAqOi8vZDI5dnprNG93MDd3aTcuY2xvdWRmcm9udC5uZXQvODliNGYwNzZhYTZmYzVmMzdjYmU1NmJhMDNkOTNjOTRkNjFmMTZjYz9yZXNwb25zZS1jb250ZW50LWRpc3Bvc2l0aW9uPWF0dGFjaG1lbnQlM0JmaWxlbmFtZSUzRCUyMnBhY2tlcl8wLjguNV9saW51eF9hbWQ2NC56aXAlMjIiLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE0Mzk4MDAzNzd9LCJJcEFkZHJlc3MiOnsiQVdTOlNvdXJjZUlwIjoiMC4wLjAuMC8wIn19fV19&Signature=lxyUrMWGVtt0uWgxvNAy-0q3Cszt3JRihyRhPNtFrTrYbHPnsJ2yaxbGGfyTZgq6-FRqJbgaZtfGUqjgR9pWRE9b6xhZmOnNrvlIMcCnZSmAcb9DLlaTkWOCLKI~8YkRkP5v5HakTxDMtZxWH7r-EmtuT4fh82~scskxgadUR0cYnyPhNZ0~oaqa1Z0-Qbnn4BK90~MIvBqhnLQL0bfl6Eq-vs9qnvI-Je7OybsaZYlHWKx6PWvZyplRyqVIeJ4HtwfpZ9ckrmhhmycqDEwrtMHI-0b-Qvz5FyebA6rzdb5GrASWAn0F38ssTY0TgGfzJvzeaKESxhHfu0RIa43rzg__&Key-Pair-Id=APKAIFKFWOMXM2UMTSFA
          unzip packer_0.8.5_linux_amd64
          ./packer version | tee $WERCKER_REPORT_MESSAGE_FILE
    - script:
        name: validate packer template
        code: ./packer validate template.json | tee $WERCKER_REPORT_MESSAGE_FILE
    - script:
        name: build image
        code: |
          ./packer build template.json | tee "${WERCKER_REPORT_ARTIFACTS_DIR}/packer_build_output.log"
          tail -n 1 "${WERCKER_REPORT_ARTIFACTS_DIR}/packer_build_output.log" | tee $WERCKER_REPORT_MESSAGE_FILE
